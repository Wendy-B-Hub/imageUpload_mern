<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    form{
      display: flex;
      flex-direction: column;
      width: 300px;
      margin: auto;
    }
    /* applying styles to all immediate child elements of the form element. The > symbol means immediate child.  */
    form > * {
      margin: 5px 0;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <form id="imageForm">
    <input id="imageInput" type="file" accept="image/*">
    <button type="submit">Upload</button>
  </form>
  <script>
    const imageForm=document.querySelector('#imageForm')
    const imageInput=document.querySelector('#imageInput')

    imageForm.addEventListener("submit",async (event)=>{
      event.preventDefault();
      const file=imageInput.files[0];
      // console.log(file)
      /*
      file:{
        name: 'birds.png', 
        lastModified: 1678652978839, 
        lastModifiedDate: Sun Mar 12 2023 13:29:38 GMT-0700 (Pacific Daylight Time), 
        webkitRelativePath: '', 
        size: 368689,
      }
      */
       //1.get secure url from our server
       const {url}=await fetch("/s3url").then(res=>res.json())   //this url is generated by s3Server.js/generateUploadUrl function

       
       //2.post the image direclty to the s3 bucket
       await fetch(url,{
          method:'PUT',
          headers:{
            "Content-Type": "multipart/form-data"
          },
          body:file
       })

       const imageUrl=url.split('?')[0]
       
       //3.post requst to my server to store any extra data
       const img=document.createElement("img");
       img.src=imageUrl
       document.body.appendChild(img)
    })
  </script>
</body>
</html>